
@{
    ViewBag.Title = "";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}


@model ReportViewer
@using AMP.ViewModels.Dashboad2

@{
    ViewBag.Title = "Report";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}
@using (Html.BeginForm("StandardLOCReportExcel", "Report", FormMethod.Post))
{
    @Html.HiddenFor(e => e.ProcedureName)
    @Html.HiddenFor(e => e.DisplayName)
    <div class="">
        <div class="page-title">
            <div class="title_left">
                <h3>Report @Model.DisplayName<small></small></h3>
            </div>
            <div class="title_right">
                <div class="pull-right">
                    <div class="col-md-5 col-sm-5 col-xs-12 form-group top_search">
                        <span class="input-group-btn">

                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-sm">
                    <div class="x_panel">
                        <div class="x_content">
                            <div class="row">
                                <div class="col-md-6">
                                    @{var k = 0;}
                                    @for (var i = 0; i < Model.Filters.Count; i++)
                                    {

                                        @Html.HiddenFor(e => Model.Filters[i].FieldType)
                                        @Html.HiddenFor(e => Model.Filters[i].FilterName)
                                        @Html.HiddenFor(e => Model.Filters[i].isNullable)
                                        @Html.HiddenFor(e => Model.Filters[i].hasDefault)
                                        @Html.HiddenFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "col-3 form-control", @placeholder = Model.Filters[i].DisplayName } })

                                        k++;
                                    }
                                    <label for="country">Country</label>
                                    <select name="Filter" id="country" class="mySelect for" multiple="multiple" style="width: 100%">
                                        @for (int x = 0; x < @ViewBag.dropdown.Reports.Count; x++)
                                        {
                                            List<ReportRow> l = new List<ReportRow>(@ViewBag.dropdown.Reports[x].Rows.CompleteRecords);
                                            foreach (var row in l.Select(e => e.Rows[1]).Distinct())
                                            {
                                                if (!string.IsNullOrWhiteSpace(row.ToString()))
                                                {
                                                    <option value="@row">@row</option>
                                                }


                                            }
                                        }

                                    </select>

                                </div>
                                <div class="col-md-6 pull-right">
                                    <label for="Project_Sector">Project Sector</label>
                                    <select name="Filter" id="Project_Sector" class="mySelect for" multiple="multiple" style="width: 100%">
                                        @for (int x = 0; x < @ViewBag.dropdown.Reports.Count; x++)
                                        {
                                            List<ReportRow> l = new List<ReportRow>(@ViewBag.dropdown.Reports[x].Rows.CompleteRecords);
                                            foreach (var row in l.Select(e => e.Rows[4]).Distinct())
                                            {
                                                if (!string.IsNullOrWhiteSpace(row.ToString()))
                                                {
                                                    <option value="@row">@row</option>
                                                }


                                            }
                                        }

                                    </select>

                                </div>

                            </div>

                            <div class="row">
                                <div class="col-md-6">

                                    <label for="Category">Category</label>
                                    <select name="Filter" id="Category" class="mySelect for" multiple="multiple" style="width: 100%">
                                        @for (int x = 0; x < @ViewBag.dropdown.Reports.Count; x++)
                                        {
                                            List<ReportRow> l = new List<ReportRow>(@ViewBag.dropdown.Reports[x].Rows.CompleteRecords);
                                            foreach (var row in l.Select(e => e.Rows[6]).Distinct())
                                            {
                                                if (!string.IsNullOrWhiteSpace(row.ToString()))
                                                {
                                                    <option value="@row">@row</option>
                                                }


                                            }
                                        }

                                    </select>

                                </div>
                                <div class="col-md-6 pull-right">
                                    <label for="Status">Status</label>
                                    <select name="Filter" id="Status" class="mySelect for" multiple="multiple" style="width: 100%">
                                        @for (int x = 0; x < @ViewBag.dropdown.Reports.Count; x++)
                                        {
                                            List<ReportRow> l = new List<ReportRow>(@ViewBag.dropdown.Reports[x].Rows.CompleteRecords);
                                            foreach (var row in l.Select(e => e.Rows[10]).Distinct())
                                            {
                                                if (!string.IsNullOrWhiteSpace(row.ToString()))
                                                {
                                                    <option value="@row">@row</option>
                                                }


                                            }
                                        }

                                    </select>

                                </div>

                            </div>

                            <div class="row">
                                <div class="col-md-6">

                                    <label for="ApplicationStart_From">Application Start From</label>
                                    <div class="form-group">
                                        <div class='input-group date' id='ApplicationStart_From_d'>
                                            <input type='text' id='ApplicationStart_From' class="form-control" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-6 pull-right">
                                    <label for="ApplicationStart_To">Application Start To</label>
                                    <div class="form-group">
                                        <div class='input-group date' id='ApplicationStart_To_d'>
                                            <input type='text' id='ApplicationStart_To' class="form-control" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>

                                </div>

                            </div>

                            <div class="row">
                                <div class="col-md-6">

                                    <label for="LastSubmissionOn_From">Last SubmissionOn From</label>
                                    <div class="form-group">
                                        <div class='input-group date' id='LastSubmissionOn_From_d'>
                                            <input type='text' id='LastSubmissionOn_From' class="form-control" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>


                                </div>
                                <div class="col-md-6 pull-right">
                                    <label for="LastSubmissionOn_To">Last SubmissionOn To</label>
                                    <div class='input-group date' id='LastSubmissionOn_To_d'>
                                        <input type='text' id='LastSubmissionOn_To' class="form-control" />
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>

                                </div>

                            </div>




                            <hr />
                            <br />
                            <div class="row">
                                <div class="col-12">
                                    <center>
                                        <button class="btn btn-default" id="check" name="check">Filter</button>
                                        <button class="btn btn-default" name="Excel" type="submit">Export To Excel!</button>

                                    </center>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="clearfix"></div>
        @for (int x = 0; x < Model.Reports.Count; x++)
        {
            @Html.HiddenFor(e => e.Reports[x].Id)
            <div class="container">
                <div class="row">
                    <div class="col-sm">
                        <div class="x_panel">
                            <div class="x_content">
                                <!-- start country list -->
                                <div class="table-responsive">
                                    <table class="table table-striped jambo_table bulk_action">
                                        <thead>
                                            <tr class="headings">
                                                @foreach (var col in Model.Reports[x].Columns)
                                                {
                                                    <th class="column-title">@col </th>
                                                }

                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var row in Model.Reports[x].Rows.Records)
                                            {
                                                if (Session["filter"] == null)
                                                {
                                                    Console.WriteLine("session is null");
                                                    <tr class="odd pointer">
                                                        @foreach (var th in row.Rows)
                                                        {
                                                            <td class="column-title">@th </td>
                                                        }
                                                    </tr>
                                                }
                                                else
                                                {
                                                    Console.WriteLine("session is not null");
                                                    if (Session["filter"].ToString().Equals(row.Rows[0]))
                                                    {
                                                        <tr class="odd pointer">
                                                            @foreach (var th in row.Rows)
                                                            {
                                                                <td class="column-title">@th </td>
                                                            }
                                                        </tr>
                                                    }
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="dataTables_info" role="status">@Model.Reports[x].Rows.Display</div>
                                    </div>
                                    <div class="col-sm-8">
                                        <input type="hidden" name="PageNo" id="PageNo" value="@Model.Reports[x].Rows.PageNo" />
                                        <div class="pull-right" style="margin-top:5px;">
                                            <span>Page Size</span>
                                            @Html.DropDownListFor(x1 => x1.Reports[x].Rows.PageSize, Model.Reports[x].Rows.PageSizes, new { @name = "PageSize", id = "pageSizeSelect" })
                                        </div>
                                        <ul id="pagination-exim" class="pagination-sm pull-right" style="margin:0px; margin-right:10px;"></ul>
                                    </div>
                                </div>
                                <!-- end country list -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}

@section scripts{
    <script src="~/Scripts/jquery.twbsPagination.min.js"></script>

    <link rel="stylesheet" href="~/Content/bootstrap-multiselect.css" type="text/css">
    <script type="text/javascript" src="~/Scripts/bootstrap-multiselect.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script>

        $(function () {
            $('#ApplicationStart_From_d').datetimepicker({ format: 'DD/MM/YYYY' });
            $('#ApplicationStart_To_d').datetimepicker({ format: 'DD/MM/YYYY' });
            $('#LastSubmissionOn_From_d').datetimepicker({ format: 'DD/MM/YYYY' });
            $('#LastSubmissionOn_To_d').datetimepicker({ format: 'DD/MM/YYYY' });
        });

        @for (var i = 0; i < Model.Filters.Count; i++)
        {
            @*if (Model.Filters[i].FieldType == "datetime")
            {
                <text>                                            $('#@Model.Filters[i].FilterName.Replace("@","")').datetimepicker({
            format: 'DD/MM/YYYY'
        });    </text>


            }*@

            if (Model.Filters[i].FilterName == "LOC_Country")
            {
                <text>
        var s =  "@Model.Filters[i].FieldValue".split(',');
        var $Multi = $("#country").select2();
           $Multi.val(s).trigger("change");
        </text>
            }
            if (Model.Filters[i].FilterName == "Project_Sector")
            {
                <text>
        var s =  "@Model.Filters[i].FieldValue".split(',');
        var $Multi = $("#Project_Sector").select2();
           $Multi.val(s).trigger("change");
        </text>
            }
            if (Model.Filters[i].FilterName == "PQ_Category")
            {
                <text>
        var s =  "@Model.Filters[i].FieldValue".split(',');
        var $Multi = $("#Category").select2();
           $Multi.val(s).trigger("change");
        </text>
            }
            if (Model.Filters[i].FilterName == "PQ_Status")
            {
                <text>
        var s =  "@Model.Filters[i].FieldValue".split(',');
        var $Multi = $("#Status").select2();
           $Multi.val(s).trigger("change");
        </text>
            }
            if (Model.Filters[i].FilterName == "PQ_ApplicationStart_From")
            {
                <text>
        var s = "@Model.Filters[i].FieldValue";
        $("#ApplicationStart_From").val(s);
        </text>
            }
            if (Model.Filters[i].FilterName == "PQ_ApplicationStart_To")
            {
                <text>
        var s = "@Model.Filters[i].FieldValue";
        $("#ApplicationStart_To").val(s);
        </text>
            }
             if (Model.Filters[i].FilterName == "PQ_LastSubmissionOn_From")
            {
                <text>
        var s = "@Model.Filters[i].FieldValue";
        $("#LastSubmissionOn_From").val(s);
        </text>
            }
             if (Model.Filters[i].FilterName == "PQ_LastSubmissionOn_To")
            {
                <text>
        var s = "@Model.Filters[i].FieldValue";
        $("#LastSubmissionOn_To").val(s);
        </text>
            }

         }
        $('#pagination-exim').twbsPagination({
        totalPages: @Model.Reports[0].Rows.Pages.Count,
        visiblePages: 10,
        startPage: @Model.Reports[0].Rows.PageNo,
        initiateStartPageClick: false,
        onPageClick: function (event, page) {
            $("#PageNo").val(page);
            let size = $("#pageSizeSelect").val();
             var country = $('#country').val();
                var Project_Sector = $('#Project_Sector').val();
                var PQ_Category = $('#Category').val();
                var PQ_Status = $('#Status').val();
                var PQ_ApplicationStart_From = $('#ApplicationStart_From').val();
                var PQ_ApplicationStart_To = $('#ApplicationStart_To').val();
                var PQ_LastSubmissionOn_From = $('#LastSubmissionOn_From').val();
                var PQ_LastSubmissionOn_To = $('#LastSubmissionOn_To').val();
                //alert("abc" + filter);
                //$.session.set('filter', filter);

                if (country == null)
                    country = "";
                if (Project_Sector == null)
                    Project_Sector = "";
                if (PQ_Category == null)
                    PQ_Category = "";
                if (PQ_Status == null)
                    PQ_Status = "";
                if (PQ_ApplicationStart_From == null)
                    PQ_ApplicationStart_From = "";
                if (PQ_ApplicationStart_To == null)
                    PQ_ApplicationStart_To = "";
                if (PQ_LastSubmissionOn_From == null)
                    PQ_LastSubmissionOn_From = "";
                if (PQ_LastSubmissionOn_To == null)
                PQ_LastSubmissionOn_To = "";
            window.location.href = "@Url.Action("PQProcessStatus", "Report")" + "?&LOC_Country=" + country + "&Project_Sector=" + Project_Sector + "&PQ_Category=" + PQ_Category + " &PQ_Status=" + PQ_Status + "&PQ_ApplicationStart_From=" + PQ_ApplicationStart_From + "&PQ_ApplicationStart_To=" + PQ_ApplicationStart_To + "&PQ_LastSubmissionOn_From=" + PQ_LastSubmissionOn_From + "&PQ_LastSubmissionOn_To=" + PQ_LastSubmissionOn_To + "&PageNo=" + page + "&PageSize=" + size;
                
            }
        });
        $(document).ready(function () {
           // $('.mdb-select').materialSelect();
            //$('#region').multiselect();
            //$('#country').multiselect();
            $(".mySelect").select2({
                placeholder: "Select",
                allowClear: false,
                minimumResultsForSearch: 5
            });
            $("#check").click(function (e) {

                var country = $('#country').val();
                var Project_Sector = $('#Project_Sector').val();
                var PQ_Category = $('#Category').val();
                var PQ_Status = $('#Status').val();
                var PQ_ApplicationStart_From = $('#ApplicationStart_From').val();
                var PQ_ApplicationStart_To = $('#ApplicationStart_To').val();
                var PQ_LastSubmissionOn_From = $('#LastSubmissionOn_From').val();
                var PQ_LastSubmissionOn_To = $('#LastSubmissionOn_To').val();
                //alert("abc" + filter);
                //$.session.set('filter', filter);

                if (country == null)
                    country = "";
                if (Project_Sector == null)
                    Project_Sector = "";
                if (PQ_Category == null)
                    PQ_Category = "";
                if (PQ_Status == null)
                    PQ_Status = "";
                if (PQ_ApplicationStart_From == null)
                    PQ_ApplicationStart_From = "";
                if (PQ_ApplicationStart_To == null)
                    PQ_ApplicationStart_To = "";
                if (PQ_LastSubmissionOn_From == null)
                    PQ_LastSubmissionOn_From = "";
                if (PQ_LastSubmissionOn_To == null)
                    PQ_LastSubmissionOn_To = "";
                window.location.href = "@Url.Action("PQProcessStatus", "Report")" + "?&LOC_Country=" + country + "&Project_Sector=" + Project_Sector + "&PQ_Category=" + PQ_Category + " &PQ_Status=" + PQ_Status + "&PQ_ApplicationStart_From=" + PQ_ApplicationStart_From + "&PQ_ApplicationStart_To=" + PQ_ApplicationStart_To + "&PQ_LastSubmissionOn_From=" + PQ_LastSubmissionOn_From + "&PQ_LastSubmissionOn_To=" + PQ_LastSubmissionOn_To;
                e.preventDefault();
            });
            $("#pageSizeSelect").val('@Model.Reports[0].Rows.PageSize');
            $("#pageSizeSelect").on("change", function () {
                let size = $("#pageSizeSelect").val();
                var country = $('#country').val();
                var Project_Sector = $('#Project_Sector').val();
                var PQ_Category = $('#Category').val();
                var PQ_Status = $('#Status').val();
                var PQ_ApplicationStart_From = $('#ApplicationStart_From').val();
                var PQ_ApplicationStart_To = $('#ApplicationStart_To').val();
                var PQ_LastSubmissionOn_From = $('#LastSubmissionOn_From').val();
                var PQ_LastSubmissionOn_To = $('#LastSubmissionOn_To').val();
                //alert("abc" + filter);
                //$.session.set('filter', filter);

                if (country == null)
                    country = "";
                if (Project_Sector == null)
                    Project_Sector = "";
                if (PQ_Category == null)
                    PQ_Category = "";
                if (PQ_Status == null)
                    PQ_Status = "";
                if (PQ_ApplicationStart_From == null)
                    PQ_ApplicationStart_From = "";
                if (PQ_ApplicationStart_To == null)
                    PQ_ApplicationStart_To = "";
                if (PQ_LastSubmissionOn_From == null)
                    PQ_LastSubmissionOn_From = "";
                if (PQ_LastSubmissionOn_To == null)
                    PQ_LastSubmissionOn_To = "";
                window.location.href = "@Url.Action("PQProcessStatus", "Report")" + "?&LOC_Country=" + country + "&Project_Sector=" + Project_Sector + "&PQ_Category=" + PQ_Category + " &PQ_Status=" + PQ_Status + "&PQ_ApplicationStart_From=" + PQ_ApplicationStart_From + "&PQ_ApplicationStart_To=" + PQ_ApplicationStart_To + "&PQ_LastSubmissionOn_From=" + PQ_LastSubmissionOn_From + "&PQ_LastSubmissionOn_To=" + PQ_LastSubmissionOn_To + "&PageNo=1&PageSize=" + size;
                
            })
        });
    </script>
}
