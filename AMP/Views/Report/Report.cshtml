@model ReportViewer
@using AMP.ViewModels.Dashboad2

@{
    ViewBag.Title = "Report";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}
@using (Html.BeginForm("Report", "Report", FormMethod.Post))
{
    @Html.HiddenFor(e => e.ProcedureName)
    @Html.HiddenFor(e => e.DisplayName)
    <div class="">
        <div class="page-title">
            <div class="title_left">
                <h3>Report @Model.DisplayName<small></small></h3>
            </div>
            <div class="title_right">
                <div class="pull-right">
                    <div class="col-md-5 col-sm-5 col-xs-12 form-group top_search">
                        <span class="input-group-btn">

                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-sm">
                    <div class="x_panel">
                        <div class="x_content">
                            <div class="row">
                                <div class="col-12">
                                    @{var k = 0;}
                                    @for (var i = 0; i < Model.Filters.Count; i++)
                                    {
                                        if (Model.Filters[i].FieldType == "datetime")
                                        {
                                            var l = 0;
                                            if ((k % 4) > 0)
                                            {
                                                for (var j = 0; j < (4 - (k % 4)); j++)
                                                {
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div style="visibility:hidden">
                                                                <label for="country-risk-categ">:</label>
                                                                <div class="col-3 form-control"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    l++;
                                                }
                                            }

                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div>
                                                        <label for="country-risk-categ">@Model.Filters[i].DisplayName :</label>
                                                        @Html.HiddenFor(e => Model.Filters[i].FieldType)
                                                        @Html.HiddenFor(e => Model.Filters[i].FilterName)
                                                        @Html.HiddenFor(e => Model.Filters[i].isNullable)
                                                        @Html.HiddenFor(e => Model.Filters[i].hasDefault)
                                                        @*@Html.EditorFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "col-4 form-control", @placeholder = Model.Filters[i].DisplayName } })*@
                                                        <fieldset>
                                                            <div class="control-group">
                                                                <div class="controls">
                                                                    <div class="col-md-11 xdisplay_inputx date has-feedback">
                                                                        @*@Html.EditorFor(e => e.MeaDate, new { htmlAttributes = new { @class = "form-control has-feedback-left", @id = "meadate", @placeholder = "First test" } })*@
                                                                        @Html.EditorFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "form-control has-feedback-left", @id = Model.Filters[i].FilterName.Replace("@", ""), @placeholder = Model.Filters[i].DisplayName } })
                                                                        <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                                                                        <span id="inputSuccess2Status2" class="sr-only">(success)</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </fieldset>

                                                    </div>
                                                </div>
                                            </div>
                                            i++; k += 4 + l;
                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div>
                                                        <label for="country-risk-categ">@Model.Filters[i].DisplayName :</label>
                                                        @Html.HiddenFor(e => Model.Filters[i].FieldType)
                                                        @Html.HiddenFor(e => Model.Filters[i].FilterName)
                                                        @Html.HiddenFor(e => Model.Filters[i].isNullable)
                                                        @Html.HiddenFor(e => Model.Filters[i].hasDefault)
                                                        @*@Html.EditorFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "col-4 form-control", @placeholder = Model.Filters[i].DisplayName } })*@
                                                        <fieldset>
                                                            <div class="control-group">
                                                                <div class="controls">
                                                                    <div class="col-md-11 xdisplay_inputx date has-feedback">
                                                                        @*@Html.EditorFor(e => e.MeaDate, new { htmlAttributes = new { @class = "form-control has-feedback-left", @id = "meadate", @placeholder = "First test" } })*@
                                                                        @Html.EditorFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "form-control has-feedback-left", @id = Model.Filters[i].FilterName.Replace("@", ""), @placeholder = Model.Filters[i].DisplayName } })
                                                                        <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                                                                        <span id="inputSuccess2Status2" class="sr-only">(success)</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </fieldset>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div style="visibility:hidden">
                                                        <label for="country-risk-categ">:</label>
                                                        <div class="col-3 form-control"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div style="visibility:hidden">
                                                        <label for="country-risk-categ">:</label>
                                                        <div class="col-3 form-control"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                        else if (Model.Filters[i].FieldType == "float")
                                        {
                                            var l = 0;
                                            if ((k % 4) > 0)
                                            {
                                                for (var j = 0; j < (4 - (k % 4)); j++)
                                                {
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div style="visibility:hidden">
                                                                <label for="country-risk-categ">:</label>
                                                                <div class="col-3 form-control"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    l++;
                                                }
                                            }

                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div>
                                                        <label for="country-risk-categ">@Model.Filters[i].DisplayName :</label>
                                                        @Html.HiddenFor(e => Model.Filters[i].FieldType)
                                                        @Html.HiddenFor(e => Model.Filters[i].FilterName)
                                                        @Html.HiddenFor(e => Model.Filters[i].isNullable)
                                                        @Html.HiddenFor(e => Model.Filters[i].hasDefault)
                                                        @Html.EditorFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "col-4 form-control", @placeholder = Model.Filters[i].DisplayName } })


                                                    </div>
                                                </div>
                                            </div>
                                            i++; k += 4 + l;
                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div>
                                                        <label for="country-risk-categ">@Model.Filters[i].DisplayName :</label>
                                                        @Html.HiddenFor(e => Model.Filters[i].FieldType)
                                                        @Html.HiddenFor(e => Model.Filters[i].FilterName)
                                                        @Html.HiddenFor(e => Model.Filters[i].isNullable)
                                                        @Html.HiddenFor(e => Model.Filters[i].hasDefault)
                                                        @Html.EditorFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "col-4 form-control", @placeholder = Model.Filters[i].DisplayName } })

                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div style="visibility:hidden">
                                                        <label for="country-risk-categ">:</label>
                                                        <div class="col-3 form-control"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div style="visibility:hidden">
                                                        <label for="country-risk-categ">:</label>
                                                        <div class="col-3 form-control"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="col-sm-3">
                                                <div class="form-group">
                                                    <div>
                                                        <label for="country-risk-categ">@Model.Filters[i].DisplayName :</label>
                                                        @Html.HiddenFor(e => Model.Filters[i].FieldType)
                                                        @Html.HiddenFor(e => Model.Filters[i].FilterName)
                                                        @Html.HiddenFor(e => Model.Filters[i].isNullable)
                                                        @Html.HiddenFor(e => Model.Filters[i].hasDefault)
                                                        @Html.EditorFor(e => Model.Filters[i].FieldValue, new { htmlAttributes = new { @class = "col-3 form-control", @placeholder = Model.Filters[i].DisplayName } })
                                                    </div>
                                                </div>
                                            </div>
                                            k++;
                                        }
                                    }
                                </div>
                            </div>
                            <hr />
                            <br />
                            <div class="row">
                                <div class="col-12">
                                    <center>
                                        <button class="btn btn-default" name="Excel" type="submit">Export To Excel!</button>
                                        <button class="btn btn-default" name="Search" type="submit">Go!</button>
                                    </center>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="clearfix"></div>
        @for (int x = 0; x < Model.Reports.Count; x++)
        {
            @Html.HiddenFor(e => e.Reports[x].Id)
            <div class="container">
                <div class="row">
                    <div class="col-sm">
                        <div class="x_panel">
                            <div class="x_content">
                                <!-- start country list -->
                                <div class="table-responsive">
                                    <table class="table table-striped jambo_table bulk_action">
                                        <thead>
                                            <tr class="headings">
                                                @foreach (var col in Model.Reports[x].Columns)
                                                {
                                                    <th class="column-title">@col </th>
                                                }

                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var row in Model.Reports[x].Rows.Records)
                                            {
                                                <tr class="odd pointer">
                                                    @foreach (var th in row.Rows)
                                                    {
                                                        <td class="column-title">@th </td>
                                                    }
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="dataTables_info" role="status">@Model.Reports[x].Rows.Display</div>
                                    </div>
                                    <div class="col-sm-8">
                                        <input type="hidden" name="PageNo" id="PageNo" value="@Model.Reports[x].Rows.PageNo" />
                                        <div class="pull-right" style="margin-top:5px;">
                                            <span>Page Size</span>
                                            @Html.DropDownListFor(x1 => x1.Reports[x].Rows.PageSize, Model.Reports[x].Rows.PageSizes, new { @name = "PageSize", id = "pageSizeSelect" })
                                        </div>
                                        <ul id="pagination-exim" class="pagination-sm pull-right" style="margin:0px; margin-right:10px;"></ul>
                                    </div>
                                </div>
                                <!-- end country list -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
                                        }

@section scripts{
    <script src="~/Scripts/jquery.twbsPagination.min.js"></script>
    <script>
        @for (var i = 0; i < Model.Filters.Count; i++)
        {
            if (Model.Filters[i].FieldType == "datetime")
            {
                <text>                                            $('#@Model.Filters[i].FilterName.Replace("@","")').datetimepicker({
            format: 'DD/MM/YYYY'
        });    </text>


            }
         }
        $('#pagination-exim').twbsPagination({
            totalPages: @Model.Reports[0].Rows.Pages.Count,
            visiblePages: 10,
            startPage: @Model.Reports[0].Rows.PageNo,
            initiateStartPageClick: false,
            onPageClick: function (event, page) {
                $("#PageNo").val(page);
                let size = $("#pageSizeSelect").val();
                window.location.href = "@Url.Action("Report", "Report")"+ "?proc=@Model.ProcedureName" + "&PageNo=" + page  + "&PageSize=" + size;;
            }
        });
        $(document).ready(function () {
            $("#pageSizeSelect").val('@Model.Reports[0].Rows.PageSize');
            $("#pageSizeSelect").on("change", function () {
                let size = $("#pageSizeSelect").val();
                window.location.href = "@Url.Action("Report", "Report")"+ "?proc=@Model.ProcedureName" + "&PageNo=1&PageSize=" + size;
            })
        });
    </script>
}
